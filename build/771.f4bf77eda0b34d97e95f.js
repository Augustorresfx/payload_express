"use strict";(self.webpackChunkpayload_template_js_blog=self.webpackChunkpayload_template_js_blog||[]).push([[771],{59771:(e,l,a)=>{a.r(l),a.d(l,{default:()=>h});var t=a(67294),i=a(16550),s=a(9980),o=a(28630),n=a(75091),d=a(47489),r=a(2143),u=a(88348),c=a(83780);const f=(e,l)=>l?e.fields.filter((e=>(0,c.fieldAffectsData)(e)&&"id"!==e.name||!0)):e.fields;var p=a(19826),v=a(40684),m=a(45074),$=a(91455),b=a(30894);const h=e=>{var l,a,c;const{collection:h,isEditing:g}=e,{slug:E,labels:{plural:S},admin:{useAsTitle:k,components:{views:{Edit:w}={}}={}}={}}=h,[C]=(0,t.useState)((()=>f(h,g))),[_]=(0,t.useState)((()=>({...h,fields:C}))),[P,Z]=(0,t.useState)(),y=(0,v.bU)(),{serverURL:L,routes:{admin:U,api:j}}=(0,s.Z)(),{params:{id:A}={}}=(0,i.$B)(),{state:D}=(0,i.TH)(),N=(0,i.k6)(),{setStepNav:R}=(0,n.FP)(),[T,x]=(0,t.useState)(),{permissions:B,user:F}=(0,o.a)(),{getVersions:G,preferencesKey:H}=(0,m.x5)(),{getPreference:K}=(0,$.G)(),V=(0,t.useCallback)((async e=>{var l;if(G(),g){const l=await(0,p.Z)({fieldSchema:_.fields,data:e.doc,user:F,id:A,operation:"update",locale:y});x(l)}else Z(`${U}/collections/${_.slug}/${null===(l=null==e?void 0:e.doc)||void 0===l?void 0:l.id}`)}),[U,_,g,G,F,A,y]),[{data:q,isLoading:z,isError:I}]=(0,d.Z)(g?`${L}${j}/${E}/${A}`:null,{initialParams:{"fallback-locale":"null",depth:0,draft:"true"}}),J=(null==D?void 0:D.data)||q;if((0,t.useEffect)((()=>{const e=[{url:`${U}/collections/${E}`,label:S}];if(g){let l="";J&&(l=k?J[k]?J[k]:"[Untitled]":J.id),e.push({label:l})}else e.push({label:"Create New"});R(e)}),[R,g,S,J,E,k,U]),(0,t.useEffect)((()=>{if(z)return;(async()=>{const e=await(0,p.Z)({fieldSchema:C,data:J,user:F,operation:g?"update":"create",id:A,locale:y});await K(H),x(e)})()}),[J,C,g,A,F,y,z,H,K]),(0,t.useEffect)((()=>{P&&N.push(P)}),[N,P]),I)return t.createElement(i.l_,{to:`${U}/not-found`});const M=null===(l=null==B?void 0:B.collections)||void 0===l?void 0:l[E],O=`${L}${j}/${E}/${A}${_.versions.drafts?"?draft=true":""}`,Q=`${L}${j}/${E}${g?`/${A}`:""}?locale=${y}&depth=0&fallback-locale=null`,W=g&&(null===(a=null==M?void 0:M.update)||void 0===a?void 0:a.permission)||!g&&(null===(c=null==M?void 0:M.create)||void 0===c?void 0:c.permission);return t.createElement(b.f.Provider,{value:1},t.createElement(r.Z,{DefaultComponent:u.Z,CustomComponent:w,componentProps:{id:A,isLoading:!T,data:J,collection:_,permissions:M,isEditing:g,onSave:V,initialState:T,hasSavePermission:W,apiURL:O,action:Q}}))}}}]);